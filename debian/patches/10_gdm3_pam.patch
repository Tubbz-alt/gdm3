Index: gdm-3.4.1/daemon/gdm-simple-slave.c
===================================================================
--- gdm-3.4.1.orig/daemon/gdm-simple-slave.c	2012-06-09 16:44:24.794210103 +0200
+++ gdm-3.4.1/daemon/gdm-simple-slave.c	2012-06-09 16:44:24.862210431 +0200
@@ -740,7 +740,7 @@ start_autologin_conversation_if_necessar
 
         g_debug ("GdmSimpleSlave: Starting automatic login conversation");
         gdm_session_start_conversation (GDM_SESSION (slave->priv->session),
-                                        "gdm-autologin");
+                                        GDM_PAM_DOMAIN "-autologin");
 }
 
 static void
@@ -1070,7 +1070,7 @@ on_greeter_begin_auto_login (GdmGreeterS
                 return;
         }
         gdm_session_setup_for_user (GDM_SESSION (slave->priv->session),
-                                    "gdm-autologin",
+                                    GDM_PAM_DOMAIN "-autologin",
                                     username);
 }
 
Index: gdm-3.4.1/configure.ac
===================================================================
--- gdm-3.4.1.orig/configure.ac	2012-06-09 16:44:13.078152829 +0200
+++ gdm-3.4.1/configure.ac	2012-06-09 16:44:24.862210431 +0200
@@ -522,6 +522,21 @@ else
 fi
 AC_SUBST(PAM_PREFIX)
 
+AC_ARG_WITH(pam-domain,
+            AS_HELP_STRING([--with-pam-domain=<domain>],
+                           [specify the naming scheme of pam files]),
+            [if test x$withval != x; then
+               AC_MSG_RESULT("PAM files will be named ${withval} and ${withval}-autologin.")
+             fi])
+
+if test x$withval != x; then
+	GDM_PAM_DOMAIN="$withval"
+else
+	GDM_PAM_DOMAIN=gdm
+fi
+AC_SUBST(GDM_PAM_DOMAIN)
+AC_DEFINE_UNQUOTED([GDM_PAM_DOMAIN], "$GDM_PAM_DOMAIN", [Naming scheme for PAM files])
+
 have_pam=no
 AC_CHECK_LIB(pam, pam_start, have_pam=yes)
 
Index: gdm-3.4.1/gui/simple-greeter/extensions/unified/Makefile.am
===================================================================
--- gdm-3.4.1.orig/gui/simple-greeter/extensions/unified/Makefile.am	2012-06-09 16:43:11.457851581 +0200
+++ gdm-3.4.1/gui/simple-greeter/extensions/unified/Makefile.am	2012-06-09 16:44:24.862210431 +0200
@@ -1,5 +1,5 @@
 NULL =
-PAM_SERVICE_NAME = gdm
+PAM_SERVICE_NAME = $(GDM_PAM_DOMAIN)
 
 extensiondir = $(GDM_SIMPLE_GREETER_EXTENSIONS_DATA_DIR)/unified
 extension_DATA = page.ui
Index: gdm-3.4.1/daemon/Makefile.am
===================================================================
--- gdm-3.4.1.orig/daemon/Makefile.am	2012-06-09 16:43:11.457851581 +0200
+++ gdm-3.4.1/daemon/Makefile.am	2012-06-09 16:44:24.866210456 +0200
@@ -20,6 +20,7 @@ AM_CPPFLAGS = \
 	-DGDM_SCREENSHOT_DIR=\"$(GDM_SCREENSHOT_DIR)\"		\
 	-DGDM_CACHE_DIR=\""$(localstatedir)/cache/gdm"\"	\
 	-DGDM_SESSION_DEFAULT_PATH=\"$(GDM_SESSION_DEFAULT_PATH)\" \
+	-DGDM_PAM_DOMAIN="\"$(GDM_PAM_DOMAIN)\""	\
 	$(DISABLE_DEPRECATED_CFLAGS)			\
 	$(DAEMON_CFLAGS)				\
 	$(XLIB_CFLAGS)					\
Index: gdm-3.4.1/daemon/gdm-greeter-server.c
===================================================================
--- gdm-3.4.1.orig/daemon/gdm-greeter-server.c	2012-06-09 16:43:11.457851581 +0200
+++ gdm-3.4.1/daemon/gdm-greeter-server.c	2012-06-09 16:45:39.662576078 +0200
@@ -253,7 +253,7 @@ translate_outgoing_service_name (GdmGree
                                  const char       *service_name)
 {
 #ifndef ENABLE_SPLIT_AUTHENTICATION
-        if (strcmp (service_name, "gdm") == 0 && greeter_server->priv->using_legacy_service_name) {
+        if (strcmp (service_name, GDM_PAM_DOMAIN) == 0 && greeter_server->priv->using_legacy_service_name) {
                 return "gdm-password";
         }
 #endif
@@ -268,7 +268,7 @@ translate_incoming_service_name (GdmGree
 #ifndef ENABLE_SPLIT_AUTHENTICATION
         if (strcmp (service_name, "gdm-password") == 0) {
                 g_debug ("GdmGreeterServer: Adjusting pam service from '%s' to 'gdm' for legacy compatibility", service_name);
-                service_name = "gdm";
+                service_name = GDM_PAM_DOMAIN;
                 greeter_server->priv->using_legacy_service_name = TRUE;
         } else if (g_str_has_prefix (service_name, "gdm-") && strcmp (service_name, "gdm-autologin") != 0) {
                 g_debug ("GdmGreeterServer: Rejecting pam service '%s' for legacy compatibility", service_name);
Index: gdm-3.4.1/daemon/test-session.c
===================================================================
--- gdm-3.4.1.orig/daemon/test-session.c	2012-06-09 16:43:11.457851581 +0200
+++ gdm-3.4.1/daemon/test-session.c	2012-06-09 16:44:24.866210456 +0200
@@ -279,7 +279,7 @@ main (int   argc,
                         username = argv[1];
                 }
 
-                gdm_session_start_conversation (GDM_SESSION (session), "gdm");
+                gdm_session_start_conversation (GDM_SESSION (session), "gdm3");
 
                 g_signal_connect (session,
                                   "conversation-started",
Index: gdm-3.4.1/gui/simple-greeter/Makefile.am
===================================================================
--- gdm-3.4.1.orig/gui/simple-greeter/Makefile.am	2012-06-09 16:46:56.766953047 +0200
+++ gdm-3.4.1/gui/simple-greeter/Makefile.am	2012-06-09 16:47:06.959002879 +0200
@@ -19,6 +19,7 @@ AM_CPPFLAGS = \
 	-DSBINDIR=\""$(sbindir)"\"		 	\
 	-DGDM_CACHE_DIR=\""$(localstatedir)/cache/gdm"\"	\
 	-DAT_SPI_REGISTRYD_DIR="\"$(AT_SPI_REGISTRYD_DIR)\""	\
+	-DGDM_PAM_DOMAIN="\"$(GDM_PAM_DOMAIN)\""	\
 	$(UPOWER_CFLAGS)				\
 	-DGDM_SIMPLE_GREETER_PLUGINS_DIR="\"$(GDM_SIMPLE_GREETER_PLUGINS_DIR)\""\
 	$(DISABLE_DEPRECATED_CFLAGS)			\
Index: gdm-3.4.1/gui/simple-greeter/gdm-greeter-login-window.c
===================================================================
--- gdm-3.4.1.orig/gui/simple-greeter/gdm-greeter-login-window.c	2012-04-14 20:52:00.000000000 +0200
+++ gdm-3.4.1/gui/simple-greeter/gdm-greeter-login-window.c	2012-06-09 16:49:09.279600877 +0200
@@ -756,7 +756,7 @@ begin_other_verification (GdmGreeterLogi
         if (find_extension_with_service_name (login_window, "gdm-password") != NULL) {
                 begin_single_service_verification (login_window, "gdm-password");
         } else {
-                begin_single_service_verification (login_window, "gdm");
+                begin_single_service_verification (login_window, GDM_PAM_DOMAIN);
         }
 }
 
@@ -988,7 +988,7 @@ handle_stopped_conversation (GdmGreeterL
          * FIXME: we need to get this policy out of the source code
          */
         if (strcmp (service_name, "gdm-password") == 0 ||
-            strcmp (service_name, "gdm") == 0) {
+            strcmp (service_name, GDM_PAM_DOMAIN) == 0) {
                 g_debug ("GdmGreeterLoginWindow: main conversation failed, starting over");
                 restart_conversations (login_window);
                 reset_dialog_after_messages (login_window, MODE_SELECTION);
