Description: Adapt to the Oneiric model for setting languages/locales.
Forwarded: not-needed
Author: Gunnar Hjalmarsson <ubuntu@gunnar.cc>

diff -Nur -x '*.orig' -x '*~' gdm-3.0.4//data/Xsession.in gdm-3.0.4.new//data/Xsession.in
--- gdm-3.0.4//data/Xsession.in	2011-08-09 14:58:58.000000000 +0200
+++ gdm-3.0.4.new//data/Xsession.in	2011-08-09 14:59:12.639636230 +0200
@@ -36,6 +36,24 @@
 test -f /etc/xprofile && . /etc/xprofile
 test -f "$HOME/.xprofile" && . "$HOME/.xprofile"
 
+# unset certain LC_* variables if they equal LANG
+if [ $LANG != ${LANG%.utf8*} ]; then
+    x_lang=${LANG%.*}.UTF-8${LANG#*.utf8}
+else
+    x_lang=${LANG%.*}.utf8${LANG#*.UTF-8}
+fi
+env_var_unset() {
+    local name=$1
+    local val=$2
+    if [ -n "$val" ] && [ $val != $LANG -a $val != $x_lang ]; then
+        return
+    fi
+    unset $name
+}
+env_var_unset 'LC_MESSAGES' $LC_MESSAGES
+env_var_unset 'LC_CTYPE' $LC_CTYPE
+env_var_unset 'LC_COLLATE' $LC_COLLATE
+
 # Translation stuff
 if [ -x "@libexecdir@/gdmtranslate" ] ; then
   gdmtranslate="@libexecdir@/gdmtranslate"
@@ -153,13 +171,6 @@
 
 unset XKB_IN_USE
 
-# Overwrite $LANG from /etc/profile (and friends) with the one picked in the
-# greeter
-if [ -n "$GDM_LANG" ]; then
-  LANG="$GDM_LANG"
-  export LANG
-fi
-
 # run all system xinitrc shell scripts.
 if [ -d /etc/X11/xinit/xinitrc.d ]; then
     for i in /etc/X11/xinit/xinitrc.d/* ; do
